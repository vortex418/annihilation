<!DOCTYPE html>
<html>
	<head>
		<link rel="stylesheet" href="/annihilation/styles.css">
		<link rel="stylesheet" href="/annihilation/libraries/font-awesome-4.css">
		<title>Annihilation [version]</title> 
		<link href="/annihilation/assets/icon.png" rel="icon" type="image/png">
		<style>
			button{font-size:15px}
			.game{position:fixed;left:0%;top:0%;width:100%;height:100%;font-size:15px;background-color:#000;z-index:0}
			.save,.server{
				margin-left:5%;margin-right:10%;margin-top:1%;margin-bottom:1%;height:10%;
				background: hsla(200,50%,25%,1);border-radius:4px;color: hsla(200,100%,90%,.8);
				box-shadow:0 0 6px hsla(200,100%,80%,1);text-shadow:0 0 7px hsla(200,100%,80%,1)
			}
			#nav_icon-settings:hover{cursor:pointer}
			.content{position:fixed;left:10%;top:10%;width:80%;height:80%}
			#sp_view-map_button:disabled:hover{cursor:not-allowed}
			.fa:hover{cursor:pointer}
		</style>
	</head>
	<body oncontextmenu="return false;">
		<a id="download_link" style="display:none;position:absolute;left:60%;top:480px;"><button>Save Game</button></a>
		<input id="namesave" type="text" style="display:none;position:absolute;left:40%;top:47.5%;width:20%;height:5%;">
		<audio id = "audio"><source src="" type="audio/mp3"></audio>
		<div id="sp_menu-main" class="game" style="background-image:url('/annihilation/assets/beta/menu.png');background-size:cover;background-repeat:no-repeat;">
			<h1 style="font-family:azonix,sans-serif;font-size:60px;position:absolute;top:15%;left:25%;width:50%;"><center>Annihilation</center></h1>
			<button id="sp_menu-main_button-sp" style="position:fixed;left:37.5%;top:45%;width:25%;height:8%;">New Game</button>
			<button id="sp_menu-main_button-mp" style="position:fixed;left:37.5%;top:60%;width:25%;height:8%;">Load Game</button>
			<button id="sp_menu-main_button-exit" style="position:fixed;left:37.5%;top:75%;width:25%;height:8%;">Exit Game</button>
		</div>
		<div id="sp_menu-save" style="display:none" class="game">
			<div id="sp_menu-save_content" class="content">
				<i id="sp_menu-save_i" class="fa fa-times" style="position:absolute;left:95%;top:5%;font-sze:30px"></i>
				<input id="sp_menu-save_input" placeholder="save name" style="position:absolute;left:30%;top:10%;width:40%;height:5%;">
				<label id="sp_menu-save_difficulty-label" style="position:absolute;left:40%;top:25%"  for="sp_menu-save_difficulty">Difficulty: Normal</label>
				<input id="sp_menu-save_difficulty" style="position:absolute;left:35%;top:30%;width:30%;height:5%" class="clickable" type="range" min="0.5" max="1.5" step="0.5" value="1">
				<button id="sp_menu-save_button" style="position:absolute;left:35%;top:80%;width:30%;height:7.5%;">Start Now</button>
			</div>
		</div>
		<div id="mp_menu-edit" class="game" style="display:none">
			<div id="mp_menu-edit_content" class="content">
				<i id="mp_menu-edit_i" class="fa fa-times" style="position:absolute;left:95%;top:5%;font-sze:30px"></i>
				<input id="mp_menu-edit_name" placeholder="display name" style="position:absolute;left:30%;top:10%;width:40%;height:5%;">
				<input id="mp_menu-edit_id" placeholder="server id" style="position:absolute;left:30%;top:20%;width:40%;height:5%;">
				<input id="mp_menu-edit_options" placeholder="options" style="position:absolute;left:30%;top:30%;width:40%;height:5%;display:none">
				<button id="mp_menu-edit_button" style="position:absolute;left:35%;top:80%;width:30%;height:7.5%;">Save</button>
			</div>
		</div>
		<div id="sp_menu-load" class="game" style="display:none">
			<ul id="sp_menu-load_content" style="position:fixed;list-style:none;left:10%;top:10%;width:80%;height:65%;overflow:scroll"></ul>
			<input id="sp_menu-load_upload" type="file"  style="display:none;">
			<button id="sp_menu-load_button-back" style="position:fixed;left:12.5%;top:80%;width:26.6%;height:7.5%;">Back</button>
			<button id="sp_menu-load_button-new" style="position:fixed;left:39.1%;top:80%;width:26.6%;height:7.5%;">New</button>
			<button id="sp_menu-load_button-upload" style="position:fixed;left:65.7%;top:80%;width:26.6%;height:7.5%;">Upload</button>
		</div>
		<div id="mp_menu-load" class="game" style="display:none">
			<ul id="mp_menu-load_content" style="position:fixed;list-style:none;left:10%;top:10%;width:80%;height:65%;overflow:scroll"></ul>
			<button id="mp_menu-load_button-back" style="position:fixed;left:12.5%;top:80%;width:26.6%;height:7.5%;">Back</button>
			<button id="mp_menu-load_button-new" style="position:fixed;left:39.1%;top:80%;width:26.6%;height:7.5%;">New</button>
			<button id="mp_menu-load_button-create" style="position:fixed;left:65.7%;top:80%;width:26.6%;height:7.5%;">Create</button>
		</div>
		<div id="sp_tips" class="game" style="display:none">
			<ul id="sp_tips_content" style="position:fixed;left:25%;top:20%;width:50%;height:60%;border:0;list-style:none;text-align:center;">
				<li><p><br>Build ships in the shipyard!</p></li>
				<li><p><br>Use the labratory to buff your ships abilities!</p></li>
				<li><p><br>Attack planets to get rewards!</p></li>
				<li><p><br>Collect taxes to get resources, though only 10 per game!</p></li>
			</ul>
			<button id="sp_tips_button" style="position:fixed;left:40%;top:75%;width:20%;height:7.5%;">Start the Game</button>
		</div>
		<div id="sp_view-map" class="background" style="display:none;position:fixed;left:10%;top:10%;width:80%;height:80%;z-index:3;">
			<center/>
			<i id="sp_view-map_i" class="fa fa-times-circle" style="position:absolute;left:95%;top:1%;font-size:35px;"></i>
			<p id="sp_view-map_p" style="position:absolute;left:30%;top:60%;font-size:20px;"></p>
			<button id="sp_view-map_button" style="position:absolute;left:30%;top:80%;width:40%;height:10%">Attack</button>
		</div>
		<div id="overlay_dev_map" class="background" style="display:none;position:fixed;left:80%;top:7.5%;width:20%;height:15%;z-index:2;">
			<input id="overlay_dev_map_input" style="position:absolute;left:5%;top:5%;width:90%;height:20%;">
			<button id="overlay_dev_map_button" style="position:absolute;left:5%;top:50%;width:90%;height:30%;">Select Planet</button>
		</div>
		<div id="sp_view-battle" style="position:fixed;left:1%;top:1%;width:10%;height:5%;display:none;z-index:3">
			<button id="sp_view-battle_button" style="position:fixed;left:1%;top:1%;width:10%;height:5%">Surrender</button>
			<div id="sp_view-battle_content" class="content background" style="position:fixed;left:12%;top:1%;width:20%;height:5%">
				<svg id="sp_view-battle_content_svg" width="100%" height="100%" viewBox="0 0 100 100" preserveAspectRatio="none">
					<rect x="10" y="10" width="80" height="30" fill="rgb(200,200,214)" stroke="rgb(200,200,214)"/>
					<rect x="10" y="60" width="80" height="30" fill="rgb(200,200,214)" stroke="rgb(200,200,214)"/>
					<rect id="sp_view-battle_content_svg_ship-health" x="10" y="10" width="80" height="30" fill="rgb(0,255,0)"/>
					<rect id="sp_view-battle_content_svg_enemy-health" x="10" y="60" width="80" height="30" fill="rgb(255,0,0)"/>
    			</svg>
				<div id="sp_view-battle_content_advanced" style="display:none;position:fixed;left:33%;top:1%;width:10%;height:5%">
					<p id="sp_view-battle_content_advanced_ship" style="position:absolute;left:10%;top:-55%;font-size:15px"></p>
					<p id="sp_view-battle_content_advanced_enemy" style="position:absolute;left:10%;top:-5%;font-size:15px"></p>
				</div>
			</div>
		</div>
		<div id="sp_view-report" class="background" style="display:none;position:fixed;left:10%;top:10%;width:80%;height:80%;z-index:2;">
			<center/>
				<i id="sp_view-report_i" class="fa fa-times-circle" style="position:absolute;left:95%;top:1%;font-size:35px;"></i>
				<p id="sp_view-report_p" style="position:absolute;left:30%;top:40%;font-size:20px;"></p>
				<button id="sp_view-report_button" style="position:absolute;left:30%;top:80%;width:40%;height:10%">Accept</button>
		</div>
		<canvas id="canvas" style="display:none;position:fixed;left:0;top:0;width:100%;height:100%;z-index:1;"></canvas>
		<div id="sp_view-yard" class="game"  style="display:none">
			<div id="sp_view-yard_content" class="content background" style="">
				<button id="sp_view-yard_content_tax-button" style="position:absolute;left:40%;top:33%;width:20%;height:5%;">Collect Taxes</button>
				<button id="sp_view-yard_content_corvette_button-new" style="position:absolute;left:5%;top:40%;width:40%;height:10%">Corvette</button>
				<button id="sp_view-yard_content_frigate_button-new" style="position:absolute;left:5%;top:60%;width:40%;height:10%">Frigate</button>
				<button id="sp_view-yard_content_crusier_button-new" style="position:absolute;left:5%;top:80%;width:40%;height:10%">Crusier</button>
				<button id="sp_view-yard_content_destroyer_button-new" style="position:absolute;left:55%;top:40%;width:40%;height:10%">Destroyer</button>
				<button id="sp_view-yard_content_battleship_button-new" style="position:absolute;left:55%;top:60%;width:40%;height:10%">Battleship</button>
				<button id="sp_view-yard_content_dreadnought_button-new" style="position:absolute;left:55%;top:80%;width:40%;height:10%">Dreadnought</button>
				<i id="sp_view-yard_content_corvette_button-up" class="fa fa-arrow-circle-o-up" aria-hidden="true" style="position:absolute;left:8%;top:42.5%;font-size:25px;"></i>
				<i id="sp_view-yard_content_frigate_button-up" class="fa fa-arrow-circle-o-up" aria-hidden="true" style="position:absolute;left:8%;top:62.5%;font-size:25px;"></i>
				<i id="sp_view-yard_content_crusier_button-up" class="fa fa-arrow-circle-o-up" aria-hidden="true" style="position:absolute;left:8%;top:82.5%;font-size:25px;"></i>
				<i id="sp_view-yard_content_destroyer_button-up" class="fa fa-arrow-circle-o-up" aria-hidden="true" style="position:absolute;left:58%;top:42.5%;font-size:25px;"></i>
				<i id="sp_view-yard_content_battleship_button-up" class="fa fa-arrow-circle-o-up" aria-hidden="true" style="position:absolute;left:58%;top:62.5%;font-size:25px;"></i>
				<i id="sp_view-yard_content_dreadnought_button-up" class="fa fa-arrow-circle-o-up" aria-hidden="true" style="position:absolute;left:58%;top:82.5%;font-size:25px;"></i>
				<i id="sp_view-yard_content_corvette_button-i" class="fa fa-info-circle" aria-hidden="true" style="position:absolute;left:39%;top:42.5%;font-size:25px;"></i>
				<i id="sp_view-yard_content_frigate_button-i" class="fa fa-info-circle" aria-hidden="true" style="position:absolute;left:39%;top:62.5%;font-size:25px;"></i>
				<i id="sp_view-yard_content_crusier_button-i" class="fa fa-info-circle" aria-hidden="true" style="position:absolute;left:39%;top:82.5%;font-size:25px;"></i>
				<i id="sp_view-yard_content_destroyer_button-i" class="fa fa-info-circle" aria-hidden="true" style="position:absolute;left:89%;top:42.5%;font-size:25px;"></i>
				<i id="sp_view-yard_content_battleship_button-i" class="fa fa-info-circle" aria-hidden="true" style="position:absolute;left:89%;top:62.5%;font-size:25px;"></i>
				<i id="sp_view-yard_content_dreadnought_button-i" class="fa fa-info-circle" aria-hidden="true" style="position:absolute;left:89%;top:82.5%;font-size:25px;"></i>
				<div id="sp_view-yard_content_resources" style="position:absolute;left:10%;top:10%;width:80%;height:20%;">
					<p id="sp_view-yard_content_resources_metal" style="position:absolute;left:5%;top:-30%;max-width:45%;max-height:45%;font-size:30px;"></p>
					<p id="sp_view-yard_content_resources_minerals" style="position:absolute;left:55%;top:-30%;max-width:45%;max-height:45%;font-size:30px;"></p>
					<p id="sp_view-yard_content_resources_fuel" style="position:absolute;left:5%;top:10%;max-width:45%;max-height:45%;font-size:30px;"></p>
					<p id="sp_view-yard_content_resources_tax" style="position:absolute;left:55%;top:10%;max-width:45%;max-height:45%;font-size:30px;"></p>
				</div>
			</div>
		</div>
		<div id="sp_view-lab" class="game" style="display:none">
			<div id="sp_view-lab_content" class="background" style="position:fixed;left:10%;top:10%;width:80%;height:80%">
				<p id="sp_view-lab_content_points" style="position:absolute;left:30%;top:0%;max-width:40%;max-height:15%;font-size:30px;"></p>
				<button id="sp_view-lab_content_armor-button" style="position:absolute;left:10%;top:25%;width:20%;height:5%;">Armor</button>
				<button id="sp_view-lab_content_laser-button" style="position:absolute;left:10%;top:75%;width:20%;height:5%;">Laser</button>
				<button id="sp_view-lab_content_reload-button" style="position:absolute;left:10%;top:50%;width:20%;height:5%;">Reload</button>
				<button id="sp_view-lab_content_construction-button" style="position:absolute;left:40%;top:37.5%;width:20%;height:5%;">Construction</button>
				<button id="sp_view-lab_content_shields-button" style="position:absolute;left:40%;top:25%;width:20%;height:5%;">Shields</button>
				<button id="sp_view-lab_content_missle-button" style="position:absolute;left:40%;top:75%;width:20%;height:5%;">Missle</button>
				<button id="sp_view-lab_content_regen-button" style="position:absolute;left:40%;top:50%;width:20%;height:5%;">Regen</button>
				<button id="sp_view-lab_content_salvage-button" style="position:absolute;left:70%;top:37.5%;width:20%;height:5%;">Salvage</button>
				<button id="sp_view-lab_content_tax-button" style="position:absolute;left:40%;top:15%;width:20%;height:5%;">Collect Taxes</button>
				<i id="sp_view-lab_content_construction-icon" class="fa fa-lock" style="position:absolute;left:42%;top:38%;font-size:20px;"></i>
				<i id="sp_view-lab_content_shields-icon" class="fa fa-lock" style="position:absolute;left:42%;top:25.5%;font-size:20px;"></i>
				<i id="sp_view-lab_content_regen-icon" class="fa fa-lock" style="position:absolute;left:42%;top:50.5%;font-size:20px;"></i>
				<i id="sp_view-lab_content_missle-icon" class="fa fa-lock" style="position:absolute;left:42%;top:75.5%;font-size:20px;"></i>
				<i id="sp_view-lab_content_salvage-icon" class="fa fa-lock" style="position:absolute;left:72%;top:38%;font-size:20px;"></i>
				<svg width="100%" height="100%" viewBox="0 0 100 100" preserveAspectRatio="none"  style="">
					<line x1="30" x2="40" y1="27.5" y2="27.5" stroke="rgb(200,200,214)"/>
					<line x1="30" x2="40" y1="52.5" y2="52.5" stroke="rgb(200,200,214)"/>
					<line x1="30" x2="40" y1="77.5" y2="77.5" stroke="rgb(200,200,214)"/>
					<line x1="30" x2="40" y1="27.5" y2="40" stroke="rgb(200,200,214)"/>
					<line x1="60" x2="70" y1="40" y2="40" stroke="rgb(200,200,214)"/>
					<line x1="30" x2="40" y1="27.5" y2="52.5" stroke="rgb(200,200,214)"/>
    			</svg>
			</div>
		</div>
		<div id="sp_menu-settings" class="game" style="display:none">
			<div id="sp_menu-settings_content" class="content background">
				<button id="sp_menu-settings_button-main" style="position:absolute;left:30%;top:15%;width:40%;height:10%">Advanced</button>
				<button id="sp_menu-settings_button-menu" style="position:absolute;left:30%;top:35%;width:40%;height:10%">Main&nbspMenu</button>
				<button id="sp_menu-settings_button-save" style="position:absolute;left:30%;top:55%;width:40%;height:10%">Download&nbspSave</button>
				<button id="sp_menu-settings_button-credits" style="position:absolute;left:30%;top:75%;width:40%;height:10%">Credits</button>
			</div>
		</div>
		<div id="sp_menu-settings_main" class="game" style="display:none">
			<div id="sp_menu-settings_main_content" class="content background">
				<center>
				<label for="sp_menu-settings_main_content_key">Key Scroll Speed</label>
				<input type="range" id="sp_menu-settings_main_content_key" min="1" max="10" step="1" value="2">
				</center>
			</div>
		</div>
		<div id="sp_menu-credits" class="game" style="display:none;position:fixed;left:0%;top:7.5%;width:100%;height:92.5%">
			<div id="sp_menu-credits_content" class="background" style="position:fixed;left:10%;top:10%;width:80%;height:80%">
				<p id="sp_meu-credits_content_p" style="position:absolute;left:10%;top:10%;width:80%;height:80%;text-align:center;">All credit goes to Vortex418 (For Now)</p>
			</div>
		</div>
		<div id="nav" style="display:none;position:fixed;left:0%;top:0%;width:100%;height:7.5%;z-index:2">
			<button id="nav_button-map" style="position:absolute;left:12.5%;top:5%;width:25%;height:90%;text-align:center;"><i class="fa fa-map" aria-hidden="true"></i> Map</button>
			<button id="nav_button-yard" style="position:absolute;left:37.5%;top:5%;width:25%;height:90%;text-align:center;"><i class="fa fa-wrench" aria-hidden="true"></i> Shipyard</button>
			<button id="nav_button-lab" style="position:absolute;left:62.5%;top:5%;width:25%;height:90%;text-align:center;"><i class="fa fa-flask" aria-hidden="true"></i> Labratory</button>
			<i id="nav_icon-settings" style="position:absolute;left:95%;top:5%;font-size:35px;text-align:center;" class="fa fa-cog" aria-hidden="true"></i>
		</div>
	</body>
	<script id="script_processing" src="/annihilation/libraries/processing.js"></script>
	<script id="script_jquery" src="/annihilation/libraries/jquery.js"></script>
	<script>
	//variables
	var keyIsPressed = false;
	var width = innerWidth;
	var height = innerHeight;
	var tab = a => {var o="";for(let i=0;i<a;i++){o += "&nbsp";if(i == a-1){return o}}};
	var br = a => {var o="";for(let i=0;i<a;i++){o += "<br>";if(i == a-1){return o}}};
	var view = "none";
	var cord = [0,0];
	var borders = [1024,576];
	var radius = [25,75];
	var date = new Date();
	date.today = date.getFullYear()+"/"+parseFloat(date.getMonth())+1+"/"+date.getDate()
	var win = {data: {},string: location.search.substring(1).split("&")};
	var canvas = {clickable: true};
	var user = {name: "",token:"",saves:[],servers:[]};
	var settings = {keySpeed: 5, fontSize:13,difficulty: 1, flags:{dev:false,mp:false}, server: []};
	var mod = {};
	var local = localStorage;
	var mouse = {x:0,y:0,pressed:false};
	const game = {
		version:location.href.split("/")[5].split(".html")[0],
		root: "/annihilation/",
		error: (title,...errs)=>{throw "GameError: "+title+"\n"+errs.reduce((msg,err) => msg+"\n"+err)},
		crash: (type,code,...etc)=>{
			console.error(`${type} Game Crash: ${code} \n	${etc.reduce((msg,e) => `${msg}\n	${e}`)}`);
			$("body").attr("style","background-image:none;background-color:blue;font-family:courier");
			$("body").html(`<p style='font-size:14px'>If this crash was not intentional, please open a bug report and send a screenshot or the below info, then just reload the page.${br(10)}Below is some data about your crash:${br(2)}Crash Type: ${type}<br>Error Code: ${code}<br>Other Info: ${etc.reduce((msg,e) => `${msg}<br>${tab(12)}${e}`)}</p>`)
		}	   
	};
	game.asset = game.root+"assets/"+game.version+"/";
	Object.freeze(game);
	//Default function overrides
Object.prototype.toString = function(){return JSON.stringify(this)};
Array.prototype.toString = function(){return JSON.stringify(this)};
Array.prototype.total = function(a){var total=0;if(typeof this[0] == "object" && a){for(let i=0;i<this.length;i++){total += this[i][a];if(i==this.length-1){return total}}}else {for(let i=0;i<this.length;i++){if(typeof this[i] == "object"){total += this[i];if(i==this.length-1){return total}}}}};
$(window).on("resize",()=> {if(!settings.flags.reload && (innerWidth != 1024 || innerHeight != 576)){location.reload()}});
Number.prototype.toStar = function(){var s="";for(let i=0;i<this;i++){s+="*"};return s};
	$("title").html("Annihilation "+game.version);console.log("ANNIHILATION: "+game.version);
	$("#sp_menu-main").css("background-image",`url('/annihilation/assets/${game.version}/menu.png')`);
	$("body").on("mousemove",e=>{mouse.x = e.clientX;mouse.y = e.clientY});
	$("body").on("click",()=>{$(".contextmenu").remove()});
	$("body").on("contextmenu",()=>{$(".contextmenu").not(":last").remove()});
	if(typeof local.saves != "string"){local.saves = "[]"}
	var save = {//_SAVE
		sel: null,
		loaded: false,
		url: null,
        local: JSON.parse(local.saves),
		data: {
			info: {},
			planet: {},
			star: {},
			ship: {},
			tech: {}
		},
		info: []
	};
	var tech = {
		points: 100,
		skill: {
			armor:{level:0,cost:5,increase_by:1.2,increase_type:"**",max:50,requires:"none"},
			laser:{level:0,cost:5,increase_by:1.2,increase_type:"**",max:50,requires:"none"},
			reload:{level:0,cost:5,increase_by:1.2,increase_type:"**",max:50,requires:"none"},
			shields:{level:0,cost:10,increase_by:1.25,increase_type:"**",max:25,requires:{armor:5}},
			missle:{level:0,cost:10,increase_by:1.25,increase_type:"**",max:25,requires:{laser:5}},
			regen:{level:0,cost:10,increase_by:1.25,increase_type:"**",max:25,requires:{reload:5,armor:15}},
			construction:{level:0,cost:10,increase_by:1.25,increase_type:"*",max:50,requires:{armor:10}},
			salvage:{level:0,cost:20,increase_by:1.25,increase_type:"**",max:25,requires:{construction:5}}
		},
		price: s => {
			if(tech.skill[s].increase_type == "+"){
				return tech.skill[s].cost+(tech.skill[s].level+tech.skill[s].increase_by)
			}
			else if(tech.skill[s].increase_type == "*"){
				return tech.skill[s].cost+(tech.skill[s].level*tech.skill[s].increase_by)
			}
			else if(tech.skill[s].increase_type == "-"){
				return tech.skill[s].cost+(tech.skill[s].level-tech.skill[s].increase_by)
			}
			else if(tech.skill[s].increase_type == "/"){
				return tech.skill[s].cost+(tech.skill[s].level/tech.skill[s].increase_by)
			}
			else if(tech.skill[s].increase_type == "**"){
				var p = tech.skill[s].cost
				if(tech.skill[s].level > 0){
				for(let i =0;i<tech.skill[s].level;i++){
					p*=tech.skill[s].increase_by
					if(i == tech.skill[s].level-1){
						return p;
					}
				}
				} else {return p}
			}
			else{game.crash("Fatal (3)","TECH_VAL_INVALID","Invalid \"increase_by\" value for tech.skill."+s)}
		}
	};
	var isHex = str => /^[0-9a-f-]+$/.test(str);
	function Save(s){
		for(let i in s){this[i] = s[i]}
		var container = $(`<li id="sp_menu-load_save-${s.name}" class="clickable save">
			<p style="display:inline-flex;font-size:18px;position:relative;left:10%;">${s.name}</p>
			<p style="display:inline-flex;font-size:18px;position:relative;left:30%;">${s.date}</p>
			<p style="display:inline-flex;font-size:18px;position:relative;left:50%;">${s.type}</p>
		</li>`);
		container.on("click",()=>{
			for(let i=0;i<save.info.length;i++){
				if(save.info[i].name == s.name){save.sel = i;container.addClass("selected")}
				else {$("#sp_menu-load_save-"+save.info[i].name).removeClass("selected")}
			}
		});
		container.on("dblclick",()=>{
			if(this.version == game.version){
				for(let i in this){
					if(i != "name" && i != "date" && i != "type" && i != "version"){
						window[i] = save.info[save.sel][i];
					}
				}
				$("#sp_menu-load").hide();$("#nav,#canvas").show();canvas.clickable=true;view = "map";redefine()
			} else {alert(`That save is not supported in the current version (${game.version})`)}
		});
		container.on("contextmenu",()=>{
			for(let i=0;i<save.info.length;i++){
				if(save.info[i].name == s.name){save.sel = i;container.addClass("selected")}
				else {$("#sp_menu-load_save-"+save.info[i].name).removeClass("selected")}	
			}
			let menu = $(`<div class="contextmenu" style="position:fixed;left:${mouse.x}px;top:${mouse.y}px"></div>`);
			let download = $('<button style="margin:10px 10px 5px 10px;">Download</button>');
			let del = $('<button style="margin:10px 5px 10px 10px;">Delete</button>');
			download.on("click",()=>{$("#download_link")[0].click()});
			del.on("click",()=>{
				if(confirm("Are you sure you want to delete this save?")){
					$(`[id="sp_menu-load_save-${s.name}"]`).remove();save.info.splice(save.sel,1);
					local.saves = save.info;save.sel = null
				}
			});
			menu.append(download,"<br>",del);
			container.parent().append(menu);
		});
		$("#sp_menu-load_content").prepend(container);
	};
	function Server(s){
		let id = s.id, d = false;
		for(let i in s){this[i] = s[i]}
		for(let i=0;i<server.length;i++){
			if(server[i].id == s.id){d = true;if(server.edit){server[i] = s}}
			if(i == server.length && d){alert("You can't have more than one server listing per server.")}
		}
		if(s.options.id == "hidden"){id = "[hidden]"}
		var container = $(`<li id="mp_menu-load_server-${s.id}" class="clickable server">
			<p style="display:inline-flex;font-size:18px;position:relative;left:10%;">${s.name}</p>
			<p style="display:inline-flex;font-size:18px;position:relative;left:30%;">${id}</p>
			<p style="display:inline-flex;font-size:18px;position:relative;left:50%;">${s.version}</p>
		</li>`);
		container.on("click",()=>{
			for(let i=0;i<server.length;i++){
				if(server[i].id == s.id){server.sel = i;container.addClass("selected")} 
				else {$(`[id="sp_menu-load_save-${s.name}"]`).removeClass("selected")}	
			}
		});
		container.on("dblclick",()=>{
			alert("Server doesn't exist");
		});
		container.on("contextmenu",()=>{
			for(let i=0;i<server.length;i++){
				if(server[i].id == s.id){server.sel = i;container.addClass("selected")} 
				else {$(`[id="#mp_menu-load_server-${server[i].id}"]`).removeClass("selected")}	
			}
			let menu = $(`<div class="contextmenu" style="position:fixed;left:${mouse.x}px;top:${mouse.y}px"></div>`);
			let edit = $('<button style="margin:10px 10px 5px 10px;">Edit</button>');
			let del = $('<button style="margin:10px 5px 10px 10px;">Delete</button>');
			edit.on("click",()=>{
				$("#mp_menu-load").hide();$("#mp_menu-edit").show();
				$("#mp_menu-edit_name").val(s.name);$("#mp_menu-edit_id").val(s.id);
				$("#mp_menu-edit_options").val(s.options);server.edit
			});
			del.on("click",()=>{
				if(confirm("Are you sure you want to delete this save?")){
					$(`[id="mp_menu-load_server-${s.id}"]`).remove();server.splice(server.sel,1);
					local.servers = server;server.sel = null
				}
			});
			menu.append(edit,"<br>",del);
			container.parent().append(menu);
		});
		if(!server.edit && !d){$("#mp_menu-load_content").prepend(container)} 
		else if(server.edit && d){$(`[id="mp_menu-load_server-${s.id}"]`)[0] = container}
	};
	var server = [];server.sel = null;server.edit;
	var numeral = ["","I","II","III","IV","V","VI","VII","VIII","IX","X","XI","XII","XIII","XIV","XV","XVI","XVII","XVIII","XIX","XX","XXI","XXII","XXIII","XXIV","XXV","XXVII","XXVII","XXVIII","XXIX","XXX","XXXI","XXXII","XXXIII","XXXIV","XXXV","XXXVI","XXXVII","XXXVIII","XXXIX","XL","XLI","XLII","XLIII","XLIV","XLV","XLVI","XLVII","XLVIII","XLIX","L","LI","LII","LIII","LIV","LV","LVI","LVII","LVIII","LIX","LX","LXI","LXII","LXIII","LXIV","LXV","LXVI","LXVII","LXVIII","LXIX","LXX","LXXI","LXXII","LXXIII","LXXIV","LXXV","LXXVI","LXXVII","LXXVIII","LXXIX","LXXX","LXXXI","LXXXII","LXXXIII","LXXXIV","LXXXV","LXXXVI","LXXXVII","LXXXVIII","LXXXIX","XC","XCI","XCII","XCIII","XCIV","XCV","XCVI","XCVII","XCVIII","XCIX","C"];
	var resource = {
		metal: 10000,
		minerals: 5000,
		fuel: 2500,
		ancient_tech: 0,
		code_snippets: 0,
		multiplyer: 1+(1-settings.difficulty),
		claimed: 0,
		max: 10
	};
	function Star(s){for(let i in s){this[i] = s[i]}}
	var star = [];star.num = 128;
	function Planet(p){
		for(let i in p){if(i != "enemies"){this[i] = p[i]}
			else{this.enemies = [];for(let e=0;e<p.enemies.length;e++){
				if(typeof p.enemies[e] == "object"){this.enemies.push(new Ship(p.enemies[e].type))}
				else{this.enemies.push(new Ship(p.enemies[e]))}
			}}
		}
		this.draw = () => {
			for(let i in this){
				if(this[i] === undefined || this[i] === ""){
					game.crash("Fatal (4)","PLANET_VALUE_INVALID",`Planet value "${i}" invalid for planet ${p.name}<br>`)
					return false
				}
			}
			if(this.taken === null){proc.fill(255,255,255)}
			else if(!this.taken){proc.fill(255,0,0)}
			else if(this.taken){proc.fill(0,255,0)}
			else{proc.fill(255,255,0)}
			proc.textSize(settings.fontSize);
			proc.text(this.name,cord[0]+this.x+proc.width/2-this.radius*.25,cord[1]+this.y+proc.height/2+this.radius*.8);
			proc.noStroke();
			proc.fill(this.color[0],this.color[1],this.color[2]);
			proc.ellipse(cord[0]+this.x+proc.width/2,cord[1]+this.y+proc.height/2,this.radius,this.radius);
			return true
		}
	};
	var planet = [];
	planet.names = ["crash site", "Abrigato", "Beta-Keralis", "Suzum", "Vespa", "Coruscare", "Vulca", "Jaeger", "Kashyyyk", "Outpost42","Victoria Alpha","Victoria Bravo", "Gesht", "Sanctuary", "Snowmass", "Ja", "Keeg", "Haemeiguli", "Borebalae", "Albataetarius", "Hataerius", "Achernaiphoros", "Antadrophei", "Hoemeirai", "Antabalis", "Hoereo", "Pazadam", "Equidor", "Pax", "Xena", "Titan", "Oturn", "Thuamia", "Heuthea", "Ditharus", "Muxater", "Trukovis", "Bichotune", "Etis", "Leorus", "Aphus", "Harophos", "Athena", "Hades", "Icarus", "Ureus", "Xentos Prime", "Delta Ketlak", "Aerox", "Thryox", "Stratus", "Nox", "Sanctum", "PastÅ«ra", "Tinctus", "Morbus", "Neos", "Nomen", "Numerus", "Pax", "Fornax", "Skorda", "Alli", "Resurs","Home!"];
	planet.difficulty = ["very easy","easy","easy-medium","medium","medium-hard","hard","very hard","extremly hard","hard-insane","insane"];
	planet.num = 65;planet.sel = 0;
	// everything ship related!
	function Ship(t){
		this.type = t;
		for(let i in ship.generic[t]){
			if(i != "cost" && i != "level" && i != "width" && i != "height"){this[i] = ship.generic[t][i]}
		}
		this.draw = (x,y,dir) => {
			proc.externals.sketch.imageCache.add(game.asset+"ships/"+this.type+"-"+dir+".png");
			var img = proc.loadImage(game.asset+"ships/"+this.type+"-"+dir+".png")
			if(typeof dir != "string"){dir = "e"}
			proc.image(img,x-20,y-20,ship.generic[this.type].width,ship.generic[this.type].height)
		};
	};
	var ShipType = (o = ship.generic.corvette) => {};
	var ship = {
		generic: {
			corvette:{health:10,damage:1,reload:2,width:25,height:24,level:0,
				cost:{metal:1000,minerals:500,fuel:250,
					ancient_tech: [1,2,4,8,16,32],code_snippets: [1,2,5,10,20,35,50]
				}
			},
			frigate:{health:25,damage:5,reload:1,width:36,height:18,level:0,
				cost: {metal:2000,minerals:2000,fuel:500,
					ancient_tech: [2,4,7,9,12,15],code_snippets: [5,10,20,30,35,40]
				}
			},
			crusier:{health:50,damage:10,reload:0.5,width:75,height:50,level:0,
				cost: {metal:4000,minerals:1000,fuel:1000,
					ancient_tech: [3,5,8,12,18,26],code_snippets: [10,20,30,40,50,60]
				}
			},
			destroyer:{health:100,damage:25,reload:1,width:100,height:50,level:0,
				cost: {metal:10000,minerals:4000,fuel:2500,
					ancient_tech: [8,12,20,35,60,75],code_snippets: [25,40,60,85,100,125]
				}
			},
			battleship:{health:250,damage:100,reload:0.5,width:150,height:60,level:0,
				cost: {metal:25000,minerals:10000,fuel:5000,
					ancient_tech: [10,25,45,70,100,135],code_snippets: [20,25,40,55,70,85]
				}
			},
			dreadnought:{health:1000,damage:250,reload:0.25,width:160,height:131,level:0,
				cost: {metal:100000,minerals:50000,fuel:25000,
					ancient_tech: [25,50,100,150,250,400],code_snippets: [50,75,88,100,125,150]
				}
			}
		},
		create: t => {ship.fleet.push(new Ship(t))},
		createType: o => {for(let i in o){ship.generic[o.name[i]] = o[i]}return ship.generic[o.name]},
		crit: {chance: 30+tech.skill.missle.level,damage: 50+tech.skill.missle.level*5},
		multiplyer: {
			damage: 1+(1-settings.difficulty)+tech.skill.laser.level*0.1,
			health: 1+(1-settings.difficulty)+tech.skill.armor.level*0.15
		},
		x: [width/64*28,width/64*28,width/64*28,width/64*28,width/64*28,width/64*28,width/64*28,width/64*20,width/64*20,width/64*20,width/64*20,width/64*20,width/64*20,width/64*20,width/64*12,width/64*12,width/64*12,width/64*12,width/64*12,width/64*12,width/64*12,width/64*4,width/64*4,width/64*4,width/64*4],
		y: [width/64*16,width/64*12,width/64*20,width/64*8,width/64*24,width/64*4,width/64*28,width/64*2,width/64*36,width/64*56,width/64*41,width/64*51,width/64*48,width/64*10,width/64*31,width/64*31,width/64*8,width/64*40,width/64*4,width/64*10,width/64*59,width/64*52,width/64*29,width/64*10,width/64*27],
		fleet: [],
		frozen: 0,
		battle: {active: false,won: null},
		num: filter =>{
			var count = 0;
			for(let i=0;i < ship.fleet.length;i++){
				if(ship.fleet[i].type == filter){count++;}
			}
			return count;
		}
	};
	var enemies = {
		x: [width/64*50,width/64*50,width/64*50,width/64*50,width/64*50,width/64*50,width/64*50,width/64*44,width/64*44,width/64*44,width/64*44,width/64*44,width/64*44,width/64*44,width/64*38,width/64*38,width/64*38,width/64*38,width/64*38,width/64*38,width/64*38],
		y: [height/64*32,height/64*24,height/64*40,height/64*16,height/64*48,height/64*8,height/64*56,height/64*32,height/64*24,height/64*40,height/64*16,height/64*48,height/64*8,height/64*56,height/64*32,height/64*24,height/64*40,height/64*16,height/64*48,height/64*8,height/64*56,height/64*32,height/64*24,height/64*40,height/64*16,height/64*48,height/64*8,height/64*56],
		type: [
			["corvette"]
			["frigate","corvette","corvette"],
			["frigate","corvette","corvette","corvette","corvette"],
			["frigate","frigate","frigate","frigate","frigate"],
			["crusier","frigate","frigate","corvette","corvette"],
			["crusier","frigate","frigate","frigate","frigate"],
			["crusier","crusier","crusier","corvette","corvette"],
			["destroyer","crusier","crusier","corvette","corvette","corvette","corvette"],
			["destroyer","crusier","crusier","frigate","frigate"],
			["destroyer","crusier","crusier","crusier","crusier"],
			["destroyer","destroyer","destroyer","crusier","crusier"],
			["destroyer","destroyer","destroyer","destroyer","destroyer"],
			["battleship","destroyer","destroyer","destroyer","destroyer"],
			["battleship","battleship","battleship","destroyer","destroyer"],
			["battleship","battleship","battleship","destroyer","destroyer","destroyer","destroyer","destroyer"],
			["battleship","battleship","battleship","battleship","crusier","crusier","frigate","frigate"],
			["battleship","battleship","battleship","battleship","battleship","battleship","frigate","frigate"],
			["battleship","battleship","battleship","battleship","battleship","battleship","crusier","crusier"],
			["battleship","battleship","battleship","battleship","battleship","battleship","battleship"],
			["battleship","battleship","battleship","battleship","battleship"],
			["battleship","battleship","battleship","battleship","battleship"],
			["battleship","battleship","battleship","battleship","battleship"],
			["battleship","battleship","battleship","battleship","battleship"],
			["battleship","battleship","battleship","battleship","battleship"],
			["battleship","battleship","battleship","battleship","battleship"],
			["battleship","battleship","battleship","battleship","battleship"],
			["battleship","battleship","battleship","battleship","battleship"],
			["battleship","battleship","battleship","battleship","battleship"],
			["battleship","battleship","battleship","battleship","battleship"],
			["battleship","battleship","battleship","battleship","battleship"],
			["battleship","battleship","battleship","battleship","battleship"],
			["battleship","battleship","battleship","battleship","battleship"],
			["battleship","battleship","battleship","battleship","battleship"],
			["battleship","battleship","battleship","battleship","battleship"],
			["battleship","battleship","battleship","battleship","battleship"],
			["battleship","battleship","battleship","battleship","battleship"],
			["battleship","battleship","battleship","battleship","battleship"],
			["battleship","battleship","battleship","battleship","battleship"],
			["battleship","battleship","battleship","battleship","battleship"],
			["battleship","battleship","battleship","battleship","battleship"],
			["battleship","battleship","battleship","battleship","battleship"],
			["battleship","battleship","battleship","battleship","battleship"],
			["battleship","battleship","battleship","battleship","battleship"],
			["battleship","battleship","battleship","battleship","battleship"],
			["battleship","battleship","battleship","battleship","battleship"],
			["battleship","battleship","battleship","battleship","battleship"],
			["battleship","battleship","battleship","battleship","battleship"],
			["battleship","battleship","battleship","battleship","battleship"],
			["battleship","battleship","battleship","battleship","battleship"],
			["battleship","battleship","battleship","battleship","battleship"],
			["battleship","battleship","battleship","battleship","battleship"],
			["battleship","battleship","battleship","battleship","battleship"],
			["battleship","battleship","battleship","battleship","battleship"],
			["battleship","battleship","battleship","battleship","battleship"],
			["battleship","battleship","battleship","battleship","battleship"],
			["battleship","battleship","battleship","battleship","battleship"],
			["battleship","battleship","battleship","battleship","battleship"],
			["battleship","battleship","battleship","battleship","battleship"],
			["battleship","battleship","battleship","battleship","battleship"],
			["battleship","battleship","battleship","battleship","battleship"],
			["battleship","battleship","battleship","battleship","battleship"],
			["battleship","battleship","battleship","battleship","battleship"],
			["battleship","battleship","battleship","battleship","battleship"],
			["battleship","battleship","battleship","battleship","battleship"],
			["dreadnought","dreadnought","dreadnought","dreadnought","dreadnought"],
			["dreadnought","dreadnought","dreadnought","dreadnought","dreadnought","dreadnought","dreadnought"]
		]
	};
	var redefine = () => {
		planet.sel = 0;
		ship.create = t => {ship.fleet.push(new Ship(t))};
		ship.createType = o => {for(let i in o){ship.generic[o.name[i]] = o[i]}return ship.generic[o.name]};
		ship.num = filter => {
			var count = 0;for(let i=0;i < ship.fleet.length;i++){if(ship.fleet[i].type == filter){count++}}return count
		};
		tech.price= s => {
			if(tech.skill[s].increase_type == "+"){
				return tech.skill[s].cost+(tech.skill[s].level+tech.skill[s].increase_by)
			}
			else if(tech.skill[s].increase_type == "*"){
				return tech.skill[s].cost+(tech.skill[s].level*tech.skill[s].increase_by)
			}
			else if(tech.skill[s].increase_type == "-"){
				return tech.skill[s].cost+(tech.skill[s].level-tech.skill[s].increase_by)
			}
			else if(tech.skill[s].increase_type == "/"){
				return tech.skill[s].cost+(tech.skill[s].level/tech.skill[s].increase_by)
			}
			else if(tech.skill[s].increase_type == "**"){
				var p = tech.skill[s].cost
				if(tech.skill[s].level > 0){
				for(let i =0;i<tech.skill[s].level;i++){
					p*=tech.skill[s].increase_by
					if(i == tech.skill[s].level-1){
						return p;
					}
				}
				} else {return p}
			}
			else{game.crash("Fatal (3)","TECH_VAL_INVALID","Invalid increase_by value for tech.skill."+s)}
		};
	};
	var $a = {//_$a
		version: game.version,
		root: game.root,
		view: view,
		width: innerWidth,
		height: innerHeight,
		cord: cord,
		borders: borders,
		radius: radius,
		date: date,
		canvas: canvas,
		user: user,
		user: user,
		save: window.save,
		planet: planet,
		ship: ship,
		star: star,
		tech: tech,
		resource: resource,
		numeral: numeral,
		settings: settings,
		win: win
	};
	var procKeys = {a: false,b: false,c: false,d: false,e: false,f: false,g: false,h: false,i: false,j: false,k: false,l: false,m: false,n: false,o: false,p: false,q: false,r: false,s: false,t: false,u: false,v: false,w: false,x: false,y: false,z: false};
	var object = (name,a,x,y,z,c) => {
		proc.fill(255,255,255);
		if(a == 0){proc.noStroke()}
		else if(a < 0){proc.stroke(255,0,0)}
		else if(a > 0){proc.stroke(0,255,0)}
        else if(typeof a == "object" && a != null && a.length == 3){proc.stroke(a[0],a[1],a[2])}
        else {game.crash("Fatal (4)","RENDER_VALUE_INVALID","alligence ("+a+") not set or invalid for object \""+name+"\"")}
		proc.text(name,x,y+(z*0.6));
		proc.fill(c[0],c[1],c[2]);
		proc.ellipse(x,y,z,z);
	};
	var minimize = n => {
		if(n > 1e+63-1){return "Infinity"}
		else if(n > 1e+33-1){return Math.round(n/1e+33)+"D"}
		else if(n > 1e+30-1){return Math.round(n/1e+30)+"N"}
		else if(n > 1e+27-1){return Math.round(n/1e+27)+"O"}
		else if(n > 1e+24-1){return Math.round(n/1e+24)+"S"}
		else if(n > 1e+21-1){return Math.round(n/1e+21)+"s"}
		else if(n > 1e+18-1){return Math.round(n/1e+18)+"Q"}
		else if(n > 1e+15-1){return Math.round(n/1e+15)+"q"}
		else if(n > 1e+12-1){return Math.round(n/1e+12)+"T"}
		else if(n > 1e+09-1){return Math.round(n/1e+09)+"B"}
		else if(n > 1e+06-1){return Math.round(n/1e+06)+"M"}
		else if(n > 1e+03-1){return Math.round(n/1e+03)+"K"}
		else if(n < 1e-03-1){return Math.round(n/1e+03)+"K"}
		else if(n < 1e-06-1){return Math.round(n/1e+03)+"M"}
		else if(n < 1e-09-1){return Math.round(n/1e+03)+"B"}
		else if(n < 1e-12-1){return Math.round(n/1e+03)+"T"}
		else if(n < 1e-15-1){return Math.round(n/1e+03)+"q"}
		else {return Math.round(n)}
 	};
	var tooltip = (sel,content,style = sel) => {
		if(!$(sel).attr("tooltip")){
			var div = $(document.createElement("div"));
			var c = content.split("<br>").length;
			var h = parseFloat(height);
			var s = {
				width: parseFloat($(style).css("width")),
				height: parseFloat($(style).css("height")),
				top: parseFloat($(style).css("top")),
				left: parseFloat($(style).css("left")),
				size: parseFloat($(style).css("font-size"))
			};
			if($(style).css("height").indexOf("%") >= 0){s.height = s.height}
			if($(style).css("top").indexOf("%") >= 0){s.top = s.top}
			div.html("<p>"+content+"</p>");
			if($(style).css("top").indexOf("%") >= 0 && s.top+s.height+s.sizePct > 100){$(div).css("top",s.top-(s.size*(c+c)*100/h))}
			else if(s.top+s.height+s.size*(c+1) > h){$(div).css("top",s.top-s.size*(c+1))}
			else if($(style).css("top").indexOf("%") >= 0){$(div).css("top",(s.top-(s.size*(c+c)*100/h))+"%");}
			else{$(div).css("top",s.top-s.size*(c+1))}
			if($(style).css("width").indexOf("%") >= 0){$(div).css("width",s.width+"%")}else{$(div).css("width",s.width)}
			if($(style).css("left").indexOf("%") >= 0){$(div).css("left",s.left+"%")}else{$(div).css("left",s.left)}
			$(div).css({height:s.size*(c*s.size/10),position:"absolute"}).attr("id","tooltip_"+sel.slice(1))
			.addClass("tooltip").hide();
			$(sel).on("mouseover",()=>{$(div).show()}).on("mouseout",()=>{$(div).hide()})
			.attr("tooltip",true).parent().append(div)
		} else {
			$("#tooltip_"+sel.slice(1)+">p").html(content)		
		}
	};
//Processing.js setup
var sketch = proc => {with(proc){var save = window.save;
var getImage = url => {externals.sketch.imageCache.add(url);return loadImage(url)};
var sound = src => {$("#audio")[0].src=game.asset+"sound/"+src;$("#audio")[0].play()};
mousePressed = ()=>{mouse.pressed = true};
mouseReleased = ()=>{mouse.pressed = false};
keyPressed = ()=>{keyIsPressed = true};
keyReleased = ()=>{keyIsPressed = false};
	
	//Game Code
	size(innerWidth,innerHeight);
	for(let i=0; i<win.string.length;i++){
		win.data[win.string[i].split("=")[0]] = decodeURIComponent(win.string[i].split("=")[1]);
		if(i == win.string.length-1 && win.data[""] !== "undefined"){
			console.groupCollapsed("Imported data");
			for(i in win.data){
				console.log(i + ": " + win.data[i])
			}
			console.groupEnd();
		}
	}
	if(win.data.flags != undefined){
		let flags = win.data.flags.split(",");
		for(let i=0;i<flags.length;i++){
			settings.flags[flags[i]] = true
			switch(flags[i]){
				case "mp":
				$("#sp_menu-main_button-sp").text("Singleplayer");
				$("#sp_menu-main_button-mp").text("Multiplayer");
				break;
			}
		}
	}
	if(win.data.name != undefined && win.data.token != undefined){
		$.get("userData/"+win.data.name+"/token",token => {
			if(win.data.token == token == local.token){
				user.name = win.data.name;
				user.active = true;
				console.log("logged in as "+user.name);
			}
		}).fail(request => {
			console.error("Couldn't log in as \""+win.data.name+"\" (Status: "+request.statusText+")");
		})
	}
	if(win.string != undefined && win.data.worldgen != undefined && win.data.worldgen != ""){
		var worldData = JSON.parse(win.data.worldgen);
		if(typeof worldData == "object"){
			if(typeof worldData.borders != undefined && worldData.borders != undefined){
				if(worldData.borders[0] > 0 && worldData.borders[1] > 0){
					borders[0] = parseFloat(worldData.borders[0]);
					borders[1] = parseFloat(worldData.borders[1]);
				}
				else if(worldData.borders[0] < 1 || worldData.borders[1] < worldData.borders[0]){borders = [innerWidth,innerHeight]}
			}
			else {console.warn("Could not load custom borders")}
			if(typeof worldData.radius != undefined && worldData.radius != undefined){
				if(worldData.radius[0] > 0 && worldData.radius[1] > worldData.radius[0]){
					radius[0] = parseFloat(worldData.radius[0]);
					radius[1] = parseFloat(worldData.radius[1]);
				}
				else if(worldData.radius[0] < 1){radius[0] = 25}
				else if(worldData.radius[1] < worldData.radius[0]+1){radius[1] = radius[0]+50}
			} 
			else {console.warn("Could not load custom radius")}
			if(typeof worldData.planets != undefined && worldData.planets != undefined){
				if(worldData.planets > 64){
					planet.num = parseFloat(worldData.planets);
				}
				else if(worldData.planets < 65){planet.num = 65}
			} 
			else{console.warn("Could not load custom planets")}
			if(typeof worldData.stars != undefined && worldData.stars != undefined){
				if(worldData.stars > 0){
					star.num = parseFloat(worldData.stars);
				}
				else if(worldData.stars < 1){star.num = 128}
			}
			else {console.warn("Could not load custom stars")}
		} else {
			game.crash("Fatal (3)","DATA_IMPORT_FAILURE","typeof worldgen must be object");
		}
	}
	for(let i = 0; i < star.num; i++){
		star[i] = {x:round(random(0-borders[0],0+borders[0])), y:round(random(0-borders[1],0+borders[1])), size:round(random(radius[0]/20,radius[1]/20))}
	}
	for(let i = 0; i < planet.num; i++){
		if(i == 0){
			planet.push(new Planet({name:"Crash Site", taken:null, x:0, y:0, radius:round(random(radius[0],radius[1])), color:[128,128,128], enemies:["corvette"]}))
		}
		else if(i > 64){
			let e = [];for(let j=0;j<i/10;j++){e[j] = "dreadnought"}
			planet.push(new Planet({name:"["+i+"]",taken:false, x:round(random(0-borders[0],0+borders[0])), y:round(random(0-borders[1],0+borders[1])), radius:round(random(radius[0],radius[1])), color: [round(random(0,255)),round(random(0,255)),round(random(0,255))], enemies:e}))
		}
		else{
			planet.push(new Planet({name:"["+i+"]"+planet.names[i], taken:false, x:round(random(0-borders[0],0+borders[0])), y:round(random(0-borders[1],0+borders[1])), radius:round(random(radius[0],radius[1])), color: [round(random(0,255)),round(random(0,255)),round(random(0,255))], enemies:enemies.type[i]}))
		}
	}
	$("#sp_menu-main_button-sp").on("click",()=>{
		if(settings.flags.mp){$("#sp_menu-main").hide();$("#sp_menu-load").show()} 
		else {$("#sp_menu-main").hide();$("#sp_menu-save").show()}
	});
	$("#sp_menu-main_button-mp").on("click",()=>{
		if(settings.flags.mp){$("#sp_menu-main").hide();$("#mp_menu-load").show()} 
		else {$("#sp_menu-main").hide();$("#sp_menu-load").show()}
	});
	$("#sp_menu-main_button-exit").on("click",()=>{close()});
	$("#sp_menu-save_i").on("click",()=>{$("#sp_menu-load").show();$("#sp_menu-save").hide()});
	$("#mp_menu-edit_i").on("click",()=>{$("#mp_menu-load").show();$("#mp_menu-edit").hide()});
	$("#sp_menu-save_button").on("click",()=>{
		let v = $("#sp_menu-save_input").val()
		if(v != ""){
			let c = true;
			for(let i=0;i<save.info.length;i++){
				if(save.info[i].name == v){c = false;alert("You can't have more than one save with the same name")}
			}
			if(c){
				save.info.push(new Save({
					name:v,
					date:date.today,
					type:"offline",
					version: game.version,
					planet: planet,
					ship: ship,
					star: star,
					tech: tech,
					resource: resource
				}));
				for(let i=0;i<save.info.length;i++){
					if(save.info[i].name == v){save.sel = i}
					else {$(`[id="sp_menu-load_save-${save.info[i].name}"]`).removeClass("selected")}	
				}
				$("#sp_menu-save").hide();$("#sp_tips").show()
			}
		} else {alert("You must enter a save name.")}
	});
	$("#mp_menu-edit_button").on("click",()=>{
		if($("#mp_menu-edit_options").val() != ""){
			server.push(new Server({
				name:$("#mp_menu-edit_name").val(),
				id:$("#mp_menu-edit_id").val(),
				options:JSON.parse($("#mp_menu-edit_options").val()),
				version: game.version
			}))
		} else {
			server.push(new Server({
				name:$("#mp_menu-edit_name").val(),
				id:$("#mp_menu-edit_id").val(),
				options:{id:"shown"},
				version: game.version
			}))
		}
		$("#mp_menu-edit").hide();$("#mp_menu-load").show()
	});
	$("#sp_menu-load_button-back").on("click",()=>{$("#sp_menu-load").hide();$("#sp_menu-main").show()});
	$("#mp_menu-load_button-back").on("click",()=>{$("#mp_menu-load").hide();$("#sp_menu-main").show()});
	$("#sp_menu-load_button-new").on("click",()=>{$("#sp_menu-load").hide();$("#sp_menu-save").show()});
	$("#mp_menu-load_button-new").on("click",()=>{
		$("#mp_menu-load").hide();$("#mp_menu-edit").show();$("#mp_menu-edit_name").val("");
		$("#mp_menu-edit_id").val("");$("#mp_menu-edit_options").val("");server.edit = false
	});
	$("#sp_menu-load_button-upload").on("click",()=>{$("#sp_menu-load_upload")[0].click()});
	$("#sp_menu-load_upload").on("change", (e)=>{
		let reader = new FileReader();
		reader.onload = ()=>{
			let u = JSON.parse(reader.result);
			if(u.version == game.version){
				for(let s=0;s<u.ship.fleet.length;s++){u.ship.fleet[s] = new Ship(u.ship.fleet[s].type)}
				for(let p=0;p<u.planet.length;p++){u.planet[p] = new Planet(u.planet[p])}
				save.info.push(new Save(u));
			} else {alert(`That save is not supported in the current version (${game.version})`)}
		};
		reader.readAsText(e.target.files[0]);	
	});
	$("#sp_tips_button").on("click",()=>{view="map";canvas.clickable=true;$("#sp_tips").hide();$("#nav,#canvas").show()});
	$("#nav_button-map").on("click",()=>{ship.battle.won=null;view="map";canvas.clickable=true;$("#sp_menu-settings,#sp_view-yard,#sp_view-lab,#sp_menu-credits,#sp_view-report,#sp_menu-settings_main").hide();$("#canvas").show()});
	$("#nav_button-yard").on("click",()=>{ship.battle.won=null;view="none";canvas.clickable=false;$("#sp_menu-settings,#sp_view-map,#sp_view-lab,#sp_menu-credits,#canvas,#sp_view-report,#sp_menu-settings_main").hide();$("#sp_view-yard").show()});
	$("#nav_button-lab").on("click",()=>{ship.battle.won=null;view="none";canvas.clickable=false;$("#sp_menu-settings,#sp_view-yard,#sp_view-map,#sp_menu-credits,#canvas,#sp_view-report,#sp_menu-settings_main").hide();$("#sp_view-lab").show()});
	$("#nav_icon-settings").on("click",()=>{ship.battle.won=null;view=
		"none";canvas.clickable=false;$("#sp_view-map,#sp_view-yard,#sp_view-lab,#sp_menu-credits,#canvas,#sp_view-report,#sp_menu-settings_main").hide();$("#sp_menu-settings").show()});
	$("#sp_menu-settings_button-menu").on("click",()=>{$("#sp_menu-settings,#nav").hide();$("#sp_menu-main").show()});
	$("#sp_menu-settings_button-credits").on("click",()=>{$("#sp_menu-settings").hide();$("#sp_menu-credits").show()});
	$("#sp_menu-settings_button-main").on("click",()=>{$("#sp_menu-settings").hide();$("#sp_menu-settings_main").show()});
	$("#sp_menu-settings_button-save").on("click",()=>{$("#download_link")[0].click()});
	for(let i in ship.generic){
		$(`#sp_view-yard_content_${i}_button-new`).on("click",()=>{
			if(resource.metal >= ship.generic[i].cost.metal*(1-tech.skill.construction.level/100) && resource.minerals >= ship.generic[i].cost.minerals*(1-tech.skill.construction.level/100) && resource.fuel >= ship.generic[i].cost.fuel*(1-tech.skill.construction.level/100)){
				resource.metal -= ship.generic[i].cost.metal*(1-tech.skill.construction.level/100);
				resource.minerals -= ship.generic[i].cost.minerals*(1-tech.skill.construction.level/100);
				resource.fuel -= ship.generic[i].cost.fuel*(1-tech.skill.construction.level/100);
				ship.create(i)   
			}
		});
		$(`#sp_view-yard_content_${i}_button-up`).on("click",()=>{
			if(ship.generic[i].level < 5 && resource.ancient_tech >= ship.generic[i].cost.ancient_tech[ship.generic[i].level] && resource.code_snippets >= ship.generic[i].cost.code_snippets[ship.generic[i].level]){
				resource.ancient_tech -= ship.generic[i].cost.ancient_tech[ship.generic[i].level];
				resource.code_snippets -= ship.generic[i].cost.code_snippets[ship.generic[i].level];
				ship.generic[i].level++
			}
		});
	}
	for(let i in tech.skill){
		$(`#sp_view-lab_content_${i}-button`).on("click",()=>{
			if(tech.points >= tech.price(i) && tech.skill[i].level < tech.skill[i].max){
				if(typeof tech.skill[i].requires == "object"){
					var unlocked = true;
					for(var r in tech.skill[i].requires){
						if(tech.skill[r].level < tech.skill[i].requires[r]){
							unlocked = false
						}
						if(unlocked){
							tech.points -= tech.price(i);tech.skill[i].level++
						}
					}
				} else {tech.points -= tech.price(i);tech.skill[i].level++}
			}
		});
	}
	$("#sp_view-yard_content_tax-button").on("click",()=>{
		if(resource.claimed < 10){
			resource.claimed++;
			for(let i=0;i<planet.length;i++){
				if(planet[i].taken){
					resource.metal += i*1000*resource.multiplyer;
					resource.minerals += i*500*resource.multiplyer;
					resource.fuel += i*400*resource.multiplyer;
					tech.points += i*resource.multiplyer;
				}
			}
		}
	});
	$("#sp_view-lab_content_tax-button").on("click",()=>{
		if(resource.claimed < 10){
			resource.claimed++;
			for(let i=0;i<planet.length;i++){
				if(planet[i].taken){
					resource.metal += i*1000*resource.multiplyer;
					resource.minerals += i*500*resource.multiplyer;
					resource.fuel += i*400*resource.multiplyer;
					tech.points += i*resource.multiplyer;
				}
			}
		}
	});
	$("#sp_view-map_i").on("click",()=>{canvas.clickable=true;$("#sp_view-map").hide()});
	$("#sp_view-map_button").on("click",()=>{view = "battle";canvas.clickable = true;$("#sp_view-map,#nav").hide();$("#sp_view-battle").show()});
	$("#sp_view-report_i").on("click",()=>{ship.battle.won=null;canvas.clickable=true;$("#sp_view-report").hide()});
	$("#sp_view-report_button").on("click",()=>{ship.battle.won=null;canvas.clickable=true;$("#sp_view-report").hide()});
	$("#sp_view-battle_button").on("click",()=>{
		ship.battle.active = false;ship.battle.won=false;canvas.clickable=false;view = "map";
		$("#sp_view-battle").hide();$("#sp_view-report,#nav").show()
	});
	$("#overlay_dev_map_button").on("click",()=>{
		mouse.pressed = false;
		planet.sel = Number($("#overlay_dev_map_input").val());
		document.body.style.cursor = "default";
		var px,py;
		if(planet.sel < planet.length){
				cord = [-planet[planet.sel].x,-planet[planet.sel].y];
				console.log("Warped to "+cord);
		} else {planet.sel = 0;alert("You must select a planet between 0 and "+planet.length-1)}
		canvas.clickable=false;
		$("#sp_view-map").show()
	});
	if(user.active){for(let i=0;i<user.saves.length;i++){save.info.push(new Save(user.saves[i]));}}
	if(save.local.length < 1){console.warn("No local saves found")}
	else{
		console.groupCollapsed("Imported Local Saves")
		for(let i=0;i<save.local.length;i++){
			if(save.local[i]){
				for(let s=0;s<save.local[i].ship.fleet.length;s++){
					save.local[i].ship.fleet[s] = new Ship(save.local[i].ship.fleet[s].type)	
				}
				for(let p=0;p<save.local[i].planet.length;p++){
					save.local[i].planet[p] = new Planet(save.local[i].planet[p]);
					if(p == save.local[i].planet.length-1){save.info.push(new Save(save.local[i]))}
				}
				console.log(save.local[i].name);planet.sel = 0;
				if(i == save.local.length-1){console.groupEnd()}
			}
		}
	}
    $("body").on("click",()=>{
		if(typeof server.sel == "number"){local.servers = server}
		if(typeof save.sel == "number"){
			$("#download_link").attr("href",URL.createObjectURL(new Blob([JSON.stringify(save.info[save.sel])],{type: "text/json"})));
			if(save.info[save.sel].name){
				$("#download_link").attr("download",save.info[save.sel].name+".json")
			}
        	if(save.info[save.sel].type == "offline"){local.saves = save.info}
			else if(save.info[save.sel].type == "online"){
				console.warn("Your "+save.info[save.sel].type+" save \""+save.info[save.sel].name+"\" could not be saved autmatically!");
			} 
        	else{game.crash("Fatal (3)","AUTOSAVE_FAILURE","Autosave failed with save \""+save.info[save.sel].name+"\" \n	at position "+save.sel)} 
		}
    });
	if(win.string && win.data.save){
		if(win.data.view == "map" || win.data.view == "yard" || win.data.view == "lab" || win.data.view == "settings"){
			for(let i = 0;i < save.info.length; i++){
				if(save.info[i].name == win.data.save){
					
					resource = save.info.data[i].resource;
					planet = save.info.data[i].planet;
					star = save.info.data[i].star;
					ship = save.info.data[i].ship;
					tech = save.info.data[i].tech;
					settings = save.info.data[i].settings;
					redefine();
					save.sel = i;
					if(win.data.view == "map"){view="map";$("#sp_menu-main").hide();$("#nav","canvas").show()}
					else if(win.data.view == "yard"){$("#sp_menu-main").hide();$("#nav","sp_view-yard").show()}
					else if(win.data.view == "lab"){$("#sp_menu-main").hide();$("#nav","sp_view-lab").show()}
					else if(win.data.view == "settings"){$("#sp_menu-main").hide();$("#nav","sp_menu-settings").show()}
					else{game.crash("Fatal (4)","DATA_IMPORT_FAILURE","Invalid value for view")}
				}
				else if(i == save.info.length-1){
					console.error("Couldn't find save \""+win.data.save+"\"");
					alert("Couldn't find save \""+win.data.save+"\"");
				}
			}
		}else{game.crash("Not-Fatal (2)","DATA_IMPORT_FAILURE","Invalid value for view")}
	}
	document.addEventListener("keydown",e=>{
    	if (e.key == "D") {
			if(dev.mode == false){dev.mode = true}else{dev.mode = false}
    	} 
		else if (e.key == "C"){game.crash("Non-Fatal (2)","MANUAL_CRASH","Manual crash initiated")}
	});
	
	

	draw = () => {//_DRAW
		background(0,0,0);
		resource.multiplyer = 1+(1-settings.difficulty);
		ship.multiplyer.damage = 1+(1-settings.difficulty)+tech.skill.laser.level*0.1;
		ship.multiplyer.health = 1+(1-settings.difficulty)+tech.skill.armor.level*0.15;
		ship.crit.chance = 30+tech.skill.missle.level;
		ship.crit.damage = 50+tech.skill.missle.level*5;
		if(!ship.battle.active){
			for(let i = 0;i < ship.fleet.length;i++){
				if(ship.fleet[i].health <= ship.generic[ship.fleet[i].type].health){
					ship.fleet[i].health += ship.generic[ship.fleet[i].type].health/(1000-tech.skill.regen.level*10);
				}
			}
			for(let i = 1;i < planet.length;i++){
				ship.frozen = ship.fleet.total("health");
				planet[i].frozen = planet[i].enemies.total("health");
			}
		}
		if(settings.keySpeed < 11){settings.keySpeed = Number($("#sp_menu-settings_main_content_key").val())}
		if(settings.difficulty < 1.6){settings.difficulty = Number($("#sp_menu-save_difficulty").val())}
		if(settings.difficulty == 0.5){$("#sp_menu-save_difficulty-label").text("Difficulty: Easy")}
		else if(settings.difficulty == 1){$("#sp_menu-save_difficulty-label").text("Difficulty: Normal")}
		else if(settings.difficulty == 1.5){$("#sp_menu-save_difficulty-label").text("Difficulty: Hard")}
		else{$("#sp_menu-save_difficulty-label").text("Difficulty: Custom")}
		if(settings.flags.debug && settings.flags.mp){$("#mp_menu-edit_options").show()}
		$("#sp_view-yard_content_resources_metal").html("Metal: "+minimize(resource.metal));
		$("#sp_view-yard_content_resources_minerals").html("Minerals: "+minimize(resource.minerals));
		$("#sp_view-yard_content_resources_fuel").html("Fuel: "+minimize(resource.fuel));
		for(let i in ship.generic){
			$("#sp_view-yard_content_"+i+"_button-new").html(ship.generic[i].level.toStar()+i+"  ["+ship.num(i)+"]");
			tooltip("#sp_view-yard_content_"+i+"_button-i","<strong>Material Cost</strong><br>Metal: "+minimize(resource.metal)+"/"+minimize(ship.generic[i].cost.metal)+"<br>Minerals: "+minimize(resource.minerals)+"/"+minimize(ship.generic[i].cost.minerals)+"<br>Fuel: "+minimize(resource.fuel)+"/"+minimize(ship.generic[i].cost.fuel)+"<br>","#sp_view-yard_content_"+i+"_button-new");
			tooltip("#sp_view-yard_content_"+i+"_button-up","Ancient Tech: "+resource.ancient_tech+"/"+ship.generic[i].cost.ancient_tech[ship.generic[i].level]+"<br>"+"Code Snippets: "+resource.code_snippets+"/"+ship.generic[i].cost.code_snippets[ship.generic[i].level],"#sp_view-yard_content_"+i+"_button-new");
		}
		tooltip("#sp_view-yard_content_tax-button","Collected: "+resource.claimed+"/"+resource.max);
		tooltip("#sp_view-lab_content_tax-button","Collected: "+resource.claimed+"/"+resource.max);
		$("#sp_view-lab_content_points").html("Research Points: "+minimize(tech.points));
		for(let i in tech.skill){
			if(tech.skill[i].level < numeral.length && tech.skill[i].level > -1){
				$("#sp_view-lab_content_"+i+"-button").html(i+" "+numeral[tech.skill[i].level])
			} 
			else {$("#sp_view-lab_content_"+i+"-button").html(i+" "+minimize(tech.skill[i].level))}
			if(typeof tech.skill[i].requires == "object"){
				var unlocked = true;
				for(var r in tech.skill[i].requires){
					if(tech.skill[r].level < tech.skill[i].requires[r]){
						unlocked = false;
					}
				}
				if(unlocked){$("#sp_view-lab_content_shields-icon").removeClass("fa-lock")}else{$("#sp_view-lab_content_shields-icon").addClass("fa-lock")}
			}
		}
		tooltip("#sp_view-lab_content_armor-button",`Increases health<br>+15% per level<br>Cost: ${round(tech.price("armor")*10)/10}`);
		tooltip("#sp_view-lab_content_laser-button",`Increases base<br>damage<br>+10% per level<br>Cost: ${round(tech.price("laser")*10)/10}`);
		tooltip("#sp_view-lab_content_reload-button",`Decreases shot<br>cooldown<br>Cost: ${round(tech.price("reload")*10)/10}`);
		tooltip("#sp_view-lab_content_construction-button",`Decreases ship<br>material cost<br>Cost: ${round(tech.price("construction")*10)/10}`);
		tooltip("#sp_view-lab_content_shields-button",`Increases shields<br>+20% per level<br>Cost: ${round(tech.price("shields")*10)/10}`);
		tooltip("#sp_view-lab_content_missle-button",`Increases critical<br>chance and<br>damage<br>+1% crit chance<br>+5% crit damage<br>Cost: ${round(tech.price("missle")*10)/10}`);
		tooltip("#sp_view-lab_content_regen-button",`Increases regen amount<br>+1% per level<br>Cost: ${round(tech.price("regen")*10)/10}`);
		tooltip("#sp_view-lab_content_salvage-button",`Increases chance<br>for rares item drops<br>+2% per level<br>Cost: ${round(tech.price("salvage")*10)/10}`);
		var statusText;
		if(planet[planet.sel].taken){$("#sp_view-map_button").disabled = true;statusText="Captured!"}
		else if(!planet[planet.sel].taken){$("#sp_view-map_button").disabled = false;statusText="Occupied!"}
		$("#sp_view-map_p").html(`Planet: ${planet[planet.sel].name}${tab(3)}Taken: ${planet[planet.sel].taken?"Yes":"No"}${br(2)}`);
		var rareText;
		if(ship.battle.won){statusText="You Won!"}else{statusText="You Lost!"}
		if(resource.random < 5+tech.skill.salvage.level){rareText="You got "+planet.sel+" ancient tech!"}
		else if(resource.random > 95-tech.skill.salvage.level){rareText="You got "+planet.sel+" code snippets!"}
		else {rareText="You didn't get any rare items!"}
		$("#sp_view-report_p").html("Planet:&nbsp"+planet[planet.sel].name+"<br><br>"+statusText+"<br><br>"+rareText);
	//Battle/Map ---> This is the processing.js that is remaining
		if(view != "map" || !settings.flags.debug){$("#overlay_dev_map").hide()}
		if(view == "map"){
			background(0,0,0);
			fill(255,255,255);
			noStroke();
			for(let i = 0; i < star.length; i++){ellipse(cord[0]+star[i].x-innerWidth/2,cord[1]+star[i].y-innerHeight/2,star[i].size,star[i].size)}
			for(let i=0;i<planet.length;i++){
				planet[i].draw();
				if(dist(-cord[0]+mouseX-innerWidth/2,-cord[1]+mouseY-innerHeight/2,planet[i].x,planet[i].y) <= planet[i].radius/2){
					document.body.style.cursor = "pointer";
					if(settings.flags.debug){
						fill(255,255,255);
						textSize(settings.fontSize);
						text(planet[i].name,innerWidth*0.01,innerHeight*0.85);
						text("["+planet[i].x+", "+planet[i].y+"]",innerWidth*0.01,innerHeight*0.9);
						text(dist(-cord[0]+mouseX-innerWidth/2,-cord[1]+mouseY-innerHeight/2,planet[i].x,planet[i].y),innerWidth*0.01,innerHeight*0.95);
						
					}
					if(mouse.pressed && canvas.clickable){planet.sel=i;mouse.pressed = false;canvas.clickable = false; document.body.style.cursor = "default";$("#sp_view-map").show()}
				} else {document.body.style.cursor = "default"}
			}
			if(settings.flags.debug){
				stroke(255,255,0);
				line(innerWidth/2,0,innerWidth/2,innerHeight);
				line(0,innerHeight/2,innerWidth,innerHeight/2);
				stroke(0,255,0);
				line(cord[0]+innerWidth/2,0,cord[0]+innerWidth/2,innerHeight);
				line(0,cord[1]+innerHeight/2,innerWidth,cord[1]+innerHeight/2);
				textSize(settings.fontSize);
				fill(255,255,255);
				text("["+cord[0]+", "+cord[1]+"]",innerWidth*0.01,innerHeight*0.10);
				text(round(-cord[0]+mouseX-innerWidth/2)+", "+round(-cord[1]+mouseY-innerHeight/2),innerWidth*0.01,innerHeight*0.15);
				text(
					round(performance.memory.usedJSHeapSize/1000000)+"MB/"+
					round(performance.memory.totalJSHeapSize/1000000)+"MB",
					 innerWidth*0.9,innerHeight*0.25
				);
				$("#overlay_dev_map").show()
			} else {$("#overlay_dev_map").hide()}
			if(keyIsPressed){procKeys[key.toString()] = true}
			else{for(i in procKeys){procKeys[i] = false}}
			if(keyIsPressed && procKeys.a && procKeys.w && borders[0]+cord[0] > 1 && borders[1]+cord[1] < borders[1]*2){
				cord[0] -= settings.keySpeed;cord[1] += settings.keySpeed
			}
			else if(keyIsPressed && procKeys.a && procKeys.s && borders[0]+cord[0] > 1 && borders[1]+cord[1] > 0){
				cord[0] -= settings.keySpeed;cord[1] -= settings.keySpeed
			}
			else if(keyIsPressed && procKeys.d && procKeys.w && borders[0]+cord[0] < borders[0]*2 && borders[1]+cord[1] < borders[1]*2){
				cord[0] += settings.keySpeed;cord[1] += settings.keySpeed
			}
			else if(keyIsPressed && procKeys.d && procKeys.s && borders[0]+cord[0] < borders[0]*2 && borders[1]+cord[1] > 0){
				cord[0] += settings.keySpeed;cord[1] -= settings.keySpeed
			}
			else if(keyIsPressed &&	(procKeys.a||keyCode == LEFT) && borders[0]+cord[0] > 1){
				cord[0] += settings.keySpeed
			}
			else if(keyIsPressed &&	(procKeys.d||keyCode == RIGHT) && borders[0]+cord[0] < borders[0]*2){
				cord[0] -= settings.keySpeed
			}
			else if(keyIsPressed &&	(procKeys.w||keyCode == UP) && borders[1]+cord[1] < borders[1]*2){
				cord[1] += settings.keySpeed
			}
			else if(keyIsPressed && (procKeys.s||keyCode == DOWN) && borders[1]+cord[1] > 0){
				cord[1] -= settings.keySpeed
			}
		}
		if(view == "battle"){
			fill(255,255,255);
			noStroke();
			for(let i = 0; i < star.length; i++){ellipse(cord[0]+star[i].x-innerWidth/2,cord[1]+star[i].y-innerHeight/2,star[i].size,star[i].size)}
			ship.battle.active = true;
			$("#sp_view-battle_content_svg_ship-health").attr("width",round(ship.fleet.total("health")/(ship.frozen/(width*0.075))));
			$("#sp_view-battle_content_svg_enemy-health").attr("width",round(planet[planet.sel].enemies.total("health")/(planet[planet.sel].frozen/(width*0.075))));
			if(settings.flags.bug){
				textAlign(LEFT,TOP);
				fill(255,255,255);
				$("#sp_view-battle_content_advanced").show()
				$("#sp_view-battle_content_advanced_ship").html(round(ship.fleet.total("health"))+"/"+round(ship.frozen));
				$("#sp_view-battle_content_advanced_enemy").html(round(planet[planet.sel].enemies.total("health"))+"/"+round(planet[planet.sel].frozen));
			}
			for(let i=0;i<ship.fleet.length;i++){
				var target = floor(random(0,planet[planet.sel].enemies.length-0.1));
				if(ship.fleet[i].health > 0){
					ship.fleet[i].reload -= ship.generic[ship.fleet[i].type].reload/100*random(8,12);
					ship.fleet[i].draw(ship.x[i],ship.y[i],"e");
					if(ship.fleet[i].reload <= 0){
						ship.crit.random = random(0,100);
						if(ship.crit.random < ship.crit.chance){
							ship.crit.dmg = 1+ship.crit.damage/100;
							textSize(settings.fontSize);
							fill(255, 128, 16);
						}else{ship.crit.dmg = 1};stroke(0,255,255);
						line(ship.x[i],ship.y[i],enemies.x[target],enemies.y[target]);
						ship.fleet[i].reload = ship.generic[ship.fleet[i].type].reload;
						planet[planet.sel].enemies[target].health -= ship.fleet[i].damage/10*(ship.multiplyer.damage* ship.crit.dmg*(ship.generic[ship.fleet[i].type].level+1));
					}
				} else {for(var s=0;s<ship.fleet.length;s++){if(s > i){ship.fleet[s-1] = ship.fleet[s]}}}
			}
			for(let i=0;i<planet[planet.sel].enemies.length;i++){
				var target = floor(random(0,ship.fleet.length));
				if(planet[planet.sel].enemies[i].health > 0){
					planet[planet.sel].enemies[i].draw(enemies.x[i],enemies.y[i],"w")
					planet[planet.sel].enemies[i].reload -= ship.generic[planet[planet.sel].enemies[i].type].reload/100*random(8,12);
					if(planet[planet.sel].enemies[i].reload <= 0){
						stroke(255,0,0);
						line(enemies.x[i], enemies.y[i], ship.x[target], ship.y[target]);
						planet[planet.sel].enemies[i].reload = ship.generic[planet[planet.sel].enemies[i].type].reload;
						ship.fleet[target].health -= (planet[planet.sel].enemies[i].damage/10)*(1-tech.skill.shields.level/100);
					}
				}		
			}
			if(planet[planet.sel].enemies.total("health") <= 0){
				planet[planet.sel].taken = true;
				ship.battle.active = false;
				resource.metal+= 5000 * planet.sel * resource.multiplyer;
				resource.minerals+= 2500 * planet.sel * resource.multiplyer;
				resource.fuel+= 2000 * planet.sel * resource.multiplyer;
				resource.random = random(0,100);
				if(resource.random < 5 + tech.skill.salvage.level){
					resource.ancient_tech += planet.sel
				}
				if(resource.random > 95 - tech.skill.salvage.level){
					resource.code_snippets += planet.sel
				}
				tech.points += 4 * planet.sel * resource.multiplyer;
				ship.battle.won = true;
				$("#sp_view-battle").hide();
				$("#sp_view-report,#nav").show();
				view = "map"
			}
			if(ship.fleet.total("health") <= 0){
				ship.battle.active = false;
				ship.battle.won = false;
				$("#sp_view-battle").hide();
				$("#sp_view-report,#nav").show();
				view = "map"
			}
		}	
	};
}};
var proc = new Processing($("#canvas")[0],sketch); 
	</script>
</html>